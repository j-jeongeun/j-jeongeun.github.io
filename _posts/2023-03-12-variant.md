---
title: 변수의 생명주기와 메모리 할당
date: 2023-03-12
categories: [variable]
tags: [variable]
---
첫 번째 포스팅 주제로 어떤 주제를 올릴까 고민하다가 메모장에 적어둔 키워드 중 가장 첫 번째 키워드로 들고 왔다.

코드를 작성하면서 수많은 변수를 선언하지만 변수의 이름만 신경을 썼지, 변수가 어디에 어떻게 생성되고 소멸되는지에 대해서는 생각해 본적이 없었던거 같다. 그러다 '객체지향의 사실과 오해'라는 책을 읽으면서 변수의 life cycle에 대해 궁금해졌다.

## 변수의 종류

변수의 종류에는 지역 변수, 매개 변수, 인스턴스 변수, 클래스 변수가 있다.
그리고 변수의 종류에 따라 life cycle과 저장되는 메모리 영역이 달라진다.

변수의 종류에 대해 간단하게 설명하고 넘어가자면 아래와 같다.

 1. 지역 변수 : 중괄호 내에서 선언된 변수들
 2. 매개 변수 : 메소드에 넘겨주고 받는 변수들 
 3. 인스턴스 변수 : 메소드 밖에, 클래스 안에 선언된 변수들 중 변수명 앞에 static이 붙지 않은 변수들
 4. 클래스 변수 : 메소드 밖에, 클래스 안에 선언된 변수들 중 변수명 앞에 static이 붙은 변수들

## 변수의 생명주기

 1. 지역 변수 : 지역 변수가 선언된 중괄호 내에서만 유효하다.
 2. 매개 변수 : 메소드가 호출될 때 생명이 시작되고, 메소드가 끝나면 소멸된다.
 3. 인스턴스 변수 : 객체가 생성될 때 생명이 시작되고, 그 객체를 참조하고 있는 다른 객체가 없으면 소멸된다.
 4. 클래스 변수 : 클래스가 처음 호출될 때 생명이 시작되고, 자바 프로그램이 끝날 때 소멸된다.

변수의 종류와 생명주기의 내용은 **'자바의 신 - 4장. 정보를 어디에 넣고 싶은데'** 챕터를 참고했다.

- 객체를 더 이상 사용하지 않으면 자동으로 소멸되는데, 이는 가비지 콜렉터(Garbage Collector)가 처리해준다. GC는 다음 포스팅이나 다다음 포스팅에서 다룰 예정이다.^^

## 변수의 메모리할당

변수의 생명주기에 대해서는 알아보았으니 변수는 어디에 어떻게 저장되는지에 대해서 알아보자.

데이터는 JVM의 데이터 영역(T 메모리 영역)에 저장된다.
T메모리 영역은 스태틱, 스택, 힙 영역으로 구분되며 각 각 클래스, 메서드, 객체를 저장하는 영역이라고 생각하면 된다.

<img width="490" alt="image" src="https://user-images.githubusercontent.com/121920173/224538605-593bba14-c64b-4a3e-936b-fc00f93a4058.png">

 1. 스태틱 영역 : static이 붙은 클래스 변수는 스태틱 영역에 저장된다. 스태틱 영역에 저장될 경우, 전역 변수로 여기저기에서 쓰일 수 있기 때문에 주의해야한다. (읽기 전용의 변수만 선언하면 좋을듯하다) 또한, 스태틱 영역의 경우 JVM이 종료될 때 같이 소멸되기 때문에 클래스 변수를 너무 남발하면 좋지 않다.
 2. 스택 영역 : 기본 자료형 타입의 변수가 저장된다.
 3. 힙 영역 : 참조 자료형 타입의 객체가 저장된다.

<hr>

원래 다음 포스팅 주제로 생각한 게 **'main() 메서드를 실행하면 어떤 일이 생길까?'** 였는데, 이번 주제에 같이 올려도 좋을 거 같다는 생각이 들어서 추가해본다.

main() 메서드를 실행하게 되며 아래의 순서대로 실행된다.
1. 서버를 올리면 JRE가 main() 메서드 여부를 확인한다.
2. main() 메서드가 존재한다면 JVM은 해당 파일을 실행한다.
3. JVM은 맨 먼저 모든 자바 프로그램에 포함되어 있는 java.lang 패키지를 T 메모리의 스태틱 영역에 가져다 놓는다.
(여기서 든 생각은 main() 메소드를 실행함과 동시에 java.lang 패키지를 스태틱 영역에 올려둠으로 해당 패키지에서 많이 쓰는 String과 System.out.println 등을 import 없이 쓸 수 있는게 아닌가라는 생각을 했다.)
4. JVM은 개발자가 작성한 모든 클래스와 import 패키지를 스태틱 영역에 올려둔다.
5. main 메서드를 스택 영역에 올린다.
6. 메서드의 인자 args를 저장할 변수 공간을 스택 영역에 맨 밑에 확보한다.
7. 스택 영역에 올라온 메서드들은 중괄호가 열릴 때 스택 영역에 올라오고 중괄호가 닫힐 때 소멸된다.
8. main() 메서드가 끝나면 JRE는 JVM을 종료하고, JRE 자체도 운영체제 상의 메모리에서 사라진다. 이로써 데이터 저장영역이었던 T메모리도 함께 소멸된다.

<hr>

알아서 잘 만들어지고 GC가 알아서 처리해주겠지라고 생각하다가 이렇게 자세히 알아보니 서로서로 얽혀 있는 개념들이 나와서 이번 포스팅 주제는 재미있게 정리해본 거 같다.
